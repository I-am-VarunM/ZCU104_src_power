/*
 * mlmodel.c
 *
 *  Created on: Mar 18, 2020
 *      Author: Carina
 */
#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include "mlmodel.h"

int lChilds[83] = {1, 2, -1, 4, 5, 6, -1, -1, -1, -1, 11, 12, 13, 14, 15, 16, 17, -1, 19, -1, -1, -1, 23, 24, 25, -1, 27, -1, 29, -1, 31, -1, 33, -1, 35, -1, 37, -1, 39, -1, 41, 42, -1, -1, 45, -1, 47, -1, -1, -1, -1, 52, -1, 54, 55, -1, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 69, -1, 71, -1, 73, 74, 75, -1, 77, -1, -1, -1, -1, -1, -1};
int rChilds[83] = {10, 3, -1, 9, 8, 7, -1, -1, -1, -1, 82, 81, 68, 51, 22, 21, 18, -1, 20, -1, -1, -1, 50, 49, 26, -1, 28, -1, 30, -1, 32, -1, 34, -1, 36, -1, 38, -1, 40, -1, 44, 43, -1, -1, 46, -1, 48, -1, -1, -1, -1, 53, -1, 67, 56, -1, 66, 65, 64, 63, 62, -1, -1, -1, -1, -1, -1, -1, 70, -1, 72, -1, 80, 79, 76, -1, 78, -1, -1, -1, -1, -1, -1};
double thresholds[83] = {7.5735039710998535, 6.732713460922241, -2.0, 7.2270426750183105, 7.057923316955566, 6.826990127563477, -2.0, -2.0, -2.0, -2.0, 21.437881469726562, 21.434252738952637, 16.74314022064209, 13.06646203994751, 8.352971076965332, 8.29033374786377, 7.981917858123779, -2.0, 8.1676607131958, -2.0, -2.0, -2.0, 11.562172889709473, 11.51498794555664, 9.07192087173462, -2.0, 9.088995456695557, -2.0, 9.416969776153564, -2.0, 9.445979595184326, -2.0, 9.750286102294922, -2.0, 9.76505994796753, -2.0, 10.343259811401367, -2.0, 10.3533034324646, -2.0, 10.389138221740723, 10.374845504760742, -2.0, -2.0, 11.321928977966309, -2.0, 11.457285404205322, -2.0, -2.0, -2.0, -2.0, 13.083110332489014, -2.0, 16.548707008361816, 13.470346927642822, -2.0, 15.392354965209961, 15.007219314575195, 14.75425672531128, 14.428095817565918, 13.8472580909729, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0, 20.19342803955078, -2.0, 20.225415229797363, -2.0, 20.86507797241211, 20.820709228515625, 20.688599586486816, -2.0, 20.73657989501953, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0};
int indices[83] = {0, 0, -2, 0, 0, 0, -2, -2, -2, -2, 0, 0, 0, 0, 0, 0, 0, -2, 0, -2, -2, -2, 0, 0, 0, -2, 0, -2, 0, -2, 0, -2, 0, -2, 0, -2, 0, -2, 0, -2, 0, 0, -2, -2, 0, -2, 0, -2, -2, -2, -2, 0, -2, 0, 0, -2, 0, 0, 0, 0, 0, -2, -2, -2, -2, -2, -2, -2, 0, -2, 0, -2, 0, 0, 0, -2, 0, -2, -2, -2, -2, -2, -2};
int classes[83][2] = {{336, 336}, {317, 3}, {312, 0}, {5, 3}, {2, 3}, {2, 1}, {0, 1}, {2, 0}, {0, 2}, {3, 0}, {19, 333}, {19, 152}, {18, 152}, {15, 96}, {9, 85}, {2, 5}, {1, 5}, {0, 3}, {1, 2}, {1, 0}, {0, 2}, {1, 0}, {7, 80}, {7, 62}, {6, 62}, {0, 16}, {6, 46}, {1, 0}, {5, 46}, {0, 8}, {5, 38}, {1, 0}, {4, 38}, {0, 10}, {4, 28}, {1, 0}, {3, 28}, {0, 9}, {3, 19}, {1, 0}, {2, 19}, {1, 2}, {0, 2}, {1, 0}, {1, 17}, {0, 13}, {1, 4}, {1, 0}, {0, 4}, {1, 0}, {0, 18}, {6, 11}, {1, 0}, {5, 11}, {4, 11}, {0, 3}, {4, 8}, {4, 5}, {3, 5}, {3, 4}, {2, 4}, {2, 3}, {0, 1}, {1, 0}, {0, 1}, {1, 0}, {0, 3}, {1, 0}, {3, 56}, {0, 33}, {3, 23}, {1, 0}, {2, 23}, {2, 13}, {1, 13}, {0, 9}, {1, 4}, {1, 0}, {0, 4}, {1, 0}, {0, 10}, {1, 0}, {0, 181}};

int findMax(int nums[N_CLASSES]) {
    int index = 0;
    for (int i = 0; i < N_CLASSES; i++) {
        index = nums[i] > nums[index] ? i : index;
    }
    return index;
}

int predict(double features[N_FEATURES], int node) {
    if (thresholds[node] != -2) {
        if (features[indices[node]] <= thresholds[node]) {
            return predict(features, lChilds[node]);
        } else {
            return predict(features, rChilds[node]);
        }
    }
    return findMax(classes[node]);
}

#ifndef RUN_NOT_STANDALONE
int main(int argc, const char * argv[]) {

    /* Features: */
    double features[argc-1];
    int i;
    for (i = 1; i < argc; i++) {
        features[i-1] = atof(argv[i]);
    }

    /* Prediction: */
    printf("%d", predict(features, 0));
    return 0;

}
#endif
